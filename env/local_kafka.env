# =============================================================================
# de_template: Local development profile (MinIO + Kafka KRaft)
# =============================================================================
# Same as local.env but uses Apache Kafka 4.0 (KRaft) instead of Redpanda.
# Useful for testing broker compatibility or matching a prod Kafka setup.
# Activate: make env-select ENV=env/local_kafka.env
# =============================================================================

# --- Infra Axes ---
BROKER=kafka             # redpanda | kafka
CATALOG=hadoop           # hadoop   | rest
STORAGE=minio            # minio    | aws_s3 | gcs | azure
MODE=batch               # Flink pipeline mode: batch | streaming_bronze

# --- Topic ---
TOPIC=taxi.raw_trips
DLQ_TOPIC=taxi.raw_trips.dlq
DLQ_MAX=0
TOPIC_RETENTION_MS=259200000   # 3 days
DLQ_RETENTION_MS=604800000     # 7 days

# --- Data Source ---
DATA_PATH=/data/yellow_tripdata_2024-01.parquet
MAX_EVENTS=0
GENERATOR_MODE=burst     # Generator send mode: burst | realtime | batch
RATE_LIMIT=0
BATCH_SIZE=1000
BATCH_DELAY=1.0
ALLOW_EMPTY=false        # true only when empty Bronze/Silver outputs are expected
DATASET_NAME=taxi         # expected dataset tag for run_metrics validation
RUN_METRICS_MAX_AGE_MINUTES=120
ALLOW_STALE_RUN_METRICS=false
REQUIRE_RUN_METRICS=true
VALIDATE_SCHEMA=false
SCHEMA_PATH=/schemas/taxi_trip.json
KEY_FIELD=PULocationID

# --- Iceberg table contract ---
BRONZE_TABLE=bronze.raw_trips
SILVER_TABLE=silver.cleaned_trips

# --- Validation thresholds/timeouts ---
BRONZE_COMPLETENESS_RATIO=0.95
WAIT_FOR_SILVER_MIN_ROWS=1
WAIT_FOR_SILVER_TIMEOUT_SECONDS=90
WAIT_FOR_SILVER_POLL_SECONDS=5
HEALTH_HTTP_TIMEOUT_SECONDS=5
HEALTH_DOCKER_TIMEOUT_SECONDS=15
ICEBERG_QUERY_TIMEOUT_SECONDS=90
ICEBERG_METADATA_TIMEOUT_SECONDS=30
DLQ_READ_TIMEOUT_SECONDS=10
DBT_TEST_TIMEOUT_SECONDS=300

# --- Warehouse ---
WAREHOUSE=s3a://warehouse/
S3_ENDPOINT=http://minio:9000
S3_USE_SSL=false
S3_PATH_STYLE=true

# --- DuckDB httpfs ---
DUCKDB_S3_ENDPOINT=minio:9000
DUCKDB_S3_USE_SSL=false
DUCKDB_UNSAFE_ENABLE_VERSION_GUESSING=true

# --- MinIO credentials ---
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# --- AWS / S3 credentials ---
AWS_ACCESS_KEY_ID=minioadmin
AWS_SECRET_ACCESS_KEY=minioadmin
AWS_REGION=us-east-1

# --- Project ---
PROJECT=de_pipeline
